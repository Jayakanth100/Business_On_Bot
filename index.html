import express from 'express'
import {createClient} from '@supabase/supabase-js'
import bodyparse from 'body-parser'
const app = express()

const port = 3000
const supabase = createClient(
    'https://epwwnkgrlzbscfuitica.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVwd3dua2dybHpic2NmdWl0aWNhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTY3NzUwNzA3OSwiZXhwIjoxOTkzMDgzMDc5fQ.r7pDzgBwwBTkT-r8bgacvGyQbYZPxBlA0stx-uE14a8'
);
app.use(bodyparse.json())
app.use(
    bodyparse.urlencoded({
        extended: true,
    })
)

app.get('/api/search', async (req, res) => {
    console.log("hi")
        const {data, error} = await supabase
            .from('Bank')
            .select()
.or(`branch.ilike.%${req.query.q.toLowerCase()}%,city.ilike.%${req.query.q.toLowerCase()}%,district.ilike.%${req.query.q.toLowerCase()}%,state.ilike.%${req.query.q.toLowerCase()}%`)
            .order('ifsc',{ascending:true})
.range(parseInt(req.query.offset),parseInt(req.query.offset)+parseInt(req.query.limit)-1)
        res.send(data)
})

app.get('/api/branch' , async (req , res)=>{
    const {data , error} = await supabase
        .from('Bank')
        .select()
        .or(`branch.ilike.%${req.query.q.toLowerCase()}%`)
        .order('ifsc' , {descending:true})      .range(parseInt(req.query.offset),parseInt(req.query.offset)+parseInt(req.query.limit)-1)
        res.send(data)
})

app.listen(port, () => {
    console.log(`App running on port ${port}.`)
})




